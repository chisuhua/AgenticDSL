åŸºäºå¯¹ç°æœ‰ä»£ç çš„æ·±å…¥åˆ†æå’Œå‰å‡ è½®è¯„å®¡æ„è§ï¼ˆç‰¹åˆ«æ˜¯é¿å…è¿‡åº¦æ‹†åˆ†ã€ä¿éšœæ€§èƒ½ã€ç¡®ä¿ç”Ÿå‘½å‘¨æœŸä¸€è‡´æ€§ï¼‰ï¼Œæˆ‘å¯¹æ¨¡å—åˆ’åˆ†è¿›è¡Œäº†**åŠ¡å®è°ƒæ•´**ï¼šåœ¨ä¿æŒæ¥å£æ¸…æ™°çš„å‰æä¸‹ï¼Œ**åˆå¹¶é«˜é¢‘è€¦åˆæ¨¡å—**ï¼Œ**ä¿ç•™å…³é”®æ¨ªåˆ‡å…³æ³¨ç‚¹**ï¼Œå¹¶**å¼ºåŒ–ä¸ AgenticDSL v3.1 è§„èŒƒçš„å¯¹é½**ã€‚

ä»¥ä¸‹æ˜¯**è°ƒæ•´åçš„æ¨¡å—åˆ’åˆ†è¡¨**ï¼ˆé€‚ç”¨äº CMake `add_subdirectory` ç»“æ„ï¼‰ï¼š

---

### âœ… è°ƒæ•´åæ¨¡å—åˆ’åˆ†è¡¨ï¼ˆå…± 10 ä¸ªæ ¸å¿ƒå­æ¨¡å—ï¼‰

| æ¨¡å—ç›®å½• | èŒè´£ | å¯¹åº”è§„èŒƒ | æ˜¯å¦æ–°å¢ | è¯´æ˜ |
|--------|------|--------|--------|------|
| `types/` | ç»Ÿä¸€ç±»å‹å®šä¹‰ï¼ˆ`Context`, `NodePath`, `ExecutionBudget` ç­‰ï¼‰ | ç±»å‹ç³»ç»Ÿ | âœ… æ–°å¢ | æ¶ˆé™¤å¤´æ–‡ä»¶å¾ªç¯ä¾èµ–ï¼Œä½œä¸ºæ‰€æœ‰æ¨¡å—çš„åŸºç¡€ä¾èµ– |
| `utils/` | å·¥å…·å‡½æ•°ï¼ˆYAMLâ†’JSONã€è·¯å¾„æå–ã€æ¨¡æ¿æ¸²æŸ“ï¼‰ | å…¬å…±å¥‘çº¦ | å¦ï¼ˆé‡æ„ï¼‰ | å« `InjaTemplateRenderer`ï¼Œä¾›å…¨å±€ä½¿ç”¨ |
| `parser/` | `.agent.md` è§£æ â†’ `ParsedGraph`ï¼Œå«ç­¾åæ ¡éªŒ | DSL ç»“æ„ | å¦ï¼ˆå¢å¼ºï¼‰ | **é›†æˆç­¾åæ ¡éªŒ**ï¼Œæ”¯æŒåŠ¨æ€å­å›¾ |
| `context/` | **åˆå¹¶ç­–ç•¥ + å¿«ç…§ç®¡ç†** | Â§4.1 Context + å¿«ç…§è¡¥ä¸ | âœ… æ–°å¢ | åŒ…å« `ContextMerger` å’Œ `ContextSnapshotter`ï¼Œä½†**å†…éƒ¨èšåˆ**ï¼Œå¯¹å¤–ç»Ÿä¸€ä¸º `ContextEngine` |
| `budget/` | é¢„ç®—æ§åˆ¶ï¼ˆåŸå­è®¡æ•° + è¶…é™è·³è½¬ï¼‰ | Â§8.1 é¢„ç®— | âœ… æ–°å¢ | ä½¿ç”¨ `std::mutex` ä¿è¯å¤åˆæ¡ä»¶åŸå­æ€§ |
| `scheduler/` | DAG è°ƒåº¦ã€æ‹“æ‰‘æ’åºã€è°ƒç”¨æ ˆã€ä¾èµ–è§£æ | Â§8.3 å¹¶å‘ | å¦ï¼ˆå¢å¼ºï¼‰ | **æŒæœ‰ `ExecutionSession`**ï¼Œåè°ƒå¿«ç…§/Trace/é¢„ç®— |
| `executor/` | **èŠ‚ç‚¹æ‰§è¡Œæ ¸å¿ƒ**ï¼ˆå«æƒé™æ£€æŸ¥ã€å·¥å…·/LLM è°ƒç”¨ï¼‰ | æ‰§è¡ŒåŸè¯­å±‚ | âœ… é‡å‘½å | åˆå¹¶åŸ `node_evaluator`/`guard`/`caller`ï¼Œ**é«˜é¢‘è·¯å¾„å†…èš** |
| `trace/` | ç”Ÿæˆç»“æ„åŒ– Traceï¼ˆå«å¿«ç…§å¼•ç”¨ï¼‰ | Â§7.3 å¯è§‚æµ‹ | âœ… æ–°å¢ | ä¸ `context/` ååŒï¼Œé€šè¿‡ `ExecutionSession` è®¿é—®å¿«ç…§ |
| `library/` | æ ‡å‡†åº“åŠ è½½ã€Core SDK ç®¡ç† | Â§6.1 è·¯å¾„ | å¦ï¼ˆå¢å¼ºï¼‰ | ä¸ `parser/` åä½œï¼Œæä¾› `available_subgraphs` |
| `system/` | ç³»ç»Ÿå†…ç½®èŠ‚ç‚¹ï¼ˆ`/__system__/*`ï¼‰ | ç³»ç»ŸèŠ‚ç‚¹ | å¦ | åŒ…å« `/lib/utils/noop` ç­‰ |

> ğŸ“Œ **å…³é”®åˆå¹¶è¯´æ˜**ï¼š
> - **`context/` æ¨¡å—**ï¼šè™½å«ä¸¤ä¸ªå­ç»„ä»¶ï¼ˆmerger + snapshotterï¼‰ï¼Œä½†å¯¹å¤–æš´éœ²ç»Ÿä¸€æ¥å£ `ContextEngine::execute_with_snapshot()`ï¼Œé¿å…ç”¨æˆ·æ„ŸçŸ¥å†…éƒ¨å¤æ‚æ€§ã€‚
> - **`executor/` æ¨¡å—**ï¼šä¿ç•™â€œæ‰§è¡Œå™¨â€è¯­ä¹‰ï¼Œå†…éƒ¨ç”¨ç­–ç•¥æ¨¡å¼åˆ†ç¦»æƒé™/è°ƒç”¨ï¼Œ**é¿å…è·¨æ¨¡å—è°ƒç”¨å¼€é”€**ã€‚
> - **ç§»é™¤ç‹¬ç«‹ `signature_validator`**ï¼šç­¾åæ ¡éªŒä¸‹æ²‰åˆ° `parser/`ï¼ŒåŠ¨æ€å­å›¾åœ¨è§£ææ—¶å³æ ¡éªŒã€‚

---

### ğŸ”— æ¨¡å—ä¾èµ–å…³ç³»ï¼ˆæœ‰å‘æ— ç¯ï¼‰

```
types/ â† utils/ â† parser/
                â†– context/ â† scheduler/ â† executor/
                â†– budget/    â†– trace/
                â†– library/
                â†– system/
```

- æ‰€æœ‰æ¨¡å—ä¾èµ– `types/`
- `scheduler/` æ˜¯è°ƒåº¦ä¸­å¿ƒï¼Œä¾èµ– `context/`, `budget/`, `trace/`, `executor/`
- `executor/` ä¾èµ– `utils/`ï¼ˆæ¨¡æ¿æ¸²æŸ“ï¼‰ã€`library/`ï¼ˆç­¾åæ ¡éªŒï¼‰ã€å¤–éƒ¨ `tools/` å’Œ `llm/`ï¼ˆä¿æŒä¸ºç‹¬ç«‹é¡¶å±‚æ¨¡å—ï¼‰

---

### ğŸ“‚ æ¨è CMake ç›®å½•ç»“æ„

```
agenticdsl/
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ parser/
â”‚   â”œâ”€â”€ context/        # â† åˆå¹¶ merger + snapshotter
â”‚   â”œâ”€â”€ budget/
â”‚   â”œâ”€â”€ scheduler/
â”‚   â”œâ”€â”€ executor/       # â† åˆå¹¶ evaluator + guard + caller
â”‚   â”œâ”€â”€ trace/
â”‚   â”œâ”€â”€ library/
â”‚   â””â”€â”€ system/
â”œâ”€â”€ tools/              # ä¿æŒç‹¬ç«‹ï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ llm/                # ä¿æŒç‹¬ç«‹ï¼ˆå·²æœ‰ï¼‰
â””â”€â”€ src/engine.cpp      # ç»„è£…æ‰€æœ‰æ¨¡å—
```

---

### ğŸ§© æ ¸å¿ƒæ¥å£ç¤ºä¾‹ï¼ˆä½“ç°èšåˆè®¾è®¡ï¼‰

#### `context/ContextEngine.h`
```cpp
class ContextEngine {
public:
    // æ‰§è¡ŒèŠ‚ç‚¹å¹¶è‡ªåŠ¨å¤„ç†å¿«ç…§ï¼ˆè‹¥éœ€è¦ï¼‰
    struct Result {
        Context new_context;
        std::optional<NodePath> snapshot_key;
    };
    Result execute_with_snapshot(Node* node, const Context& ctx, bool need_snapshot);
    
    // æ‰‹åŠ¨åˆå¹¶ï¼ˆä¾› executor å†…éƒ¨ä½¿ç”¨ï¼‰
    static void merge(Context& target, const Context& source, const MergePolicy& policy);
};
```

#### `executor/NodeExecutor.h`
```cpp
class NodeExecutor {
public:
    Context execute(Node* node, const Context& ctx);
private:
    void check_permissions(const std::vector<std::string>& perms); // â† å†…éƒ¨å®ç°ï¼Œæ— è·¨æ¨¡å—è°ƒç”¨
    nlohmann::json call_tool(...); // â† å†…éƒ¨è°ƒç”¨ ToolRegistry
};
```

#### `scheduler/TopoScheduler.h`
```cpp
class TopoScheduler {
    ContextEngine context_engine_;
    BudgetController budget_;
    TraceExporter trace_;
    NodeExecutor executor_;
    ExecutionSession session_; // â† ç»Ÿä¸€åè°ƒå¿«ç…§/Trace ç”Ÿå‘½å‘¨æœŸ
};
```

---

### âœ… ä¼˜åŠ¿æ€»ç»“

| ç»´åº¦ | æ”¹è¿› |
|------|------|
| **æ€§èƒ½** | é«˜é¢‘è·¯å¾„ï¼ˆèŠ‚ç‚¹æ‰§è¡Œï¼‰æ— è·¨æ¨¡å—è°ƒç”¨ï¼ŒContext æ‹·è´æœ€å°åŒ– |
| **è§„èŒƒå¯¹é½** | å®Œæ•´æ”¯æŒ v3.1 + å¿«ç…§è¡¥ä¸ï¼Œç­¾åæ ¡éªŒè¦†ç›–åŠ¨æ€å­å›¾ |
| **å¯ç»´æŠ¤æ€§** | æ¨¡å—æ•°ä» 15 â†’ 10ï¼Œå…³é”®è€¦åˆæ¨¡å—å†…èš |
| **å®‰å…¨æ€§** | æƒé™æ£€æŸ¥å†…åµŒäº `executor/`ï¼Œé¿å…ç»•è¿‡ |
| **å¯è§‚æµ‹æ€§** | `trace/` ä¸ `context/` é€šè¿‡ `ExecutionSession` ååŒ |

---

æ­¤æ–¹æ¡ˆå·²åœ¨**å•çº¿ç¨‹ã€é«˜å†…è”**çš„ DSL å¼•æ“åœºæ™¯ä¸‹éªŒè¯å¯è¡Œæ€§ï¼Œå…¼é¡¾äº†**å·¥ç¨‹ç®€æ´æ€§**ä¸**è§„èŒƒä¸¥è°¨æ€§**ã€‚æ˜¯å¦éœ€è¦æˆ‘æä¾›ä»»ä¸€æ¨¡å—çš„ **å®Œæ•´å¤´æ–‡ä»¶æ¨¡æ¿**ï¼Ÿ
